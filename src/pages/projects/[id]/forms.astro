---
/**
 * Project Forms Page
 * Create and manage project documents (RFIs, Change Orders, Daily Reports, Submittals)
 */
import Layout from '../../../layouts/Layout.astro';
import ProjectModuleNav from '../../../components/ProjectModuleNav.tsx';
import ProjectHeader from '../../../components/ProjectHeader.tsx';
import RFIForm from '../../../components/forms/RFIForm.tsx';
import ChangeOrderForm from '../../../components/forms/ChangeOrderForm.tsx';
import DailyReportForm from '../../../components/forms/DailyReportForm.tsx';
import SubmittalForm from '../../../components/forms/SubmittalForm.tsx';

export const prerender = false;

const { id } = Astro.params;
---

<Layout title="Project Forms - ConstructAid">
  <ProjectModuleNav projectId={id!} client:load />
  <ProjectHeader client:load projectId={id!} moduleName="Forms" moduleIcon="üìã" />

  <!-- Main Content Area with Left Margin for Sidebar -->
  <div class="min-h-screen bg-gray-900 ml-64">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
      <!-- Page Header -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-white mb-2">Project Forms</h1>
        <p class="text-gray-400">Create and manage project documentation</p>
      </div>

      <!-- Form Selector -->
      <div id="form-selector" class="mb-8">
        <div class="bg-gray-800 rounded-lg shadow-md p-6 border border-gray-700">
          <h2 class="text-xl font-bold text-white mb-4">Select Form Type</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <button
              data-form="rfi"
              class="form-selector-btn p-6 border-2 border-gray-600 rounded-lg hover:border-blue-500 hover:bg-blue-900/30 transition-all text-left"
            >
              <div class="text-3xl mb-2">üìã</div>
              <h3 class="font-semibold text-white mb-1">RFI</h3>
              <p class="text-sm text-gray-400">Request for Information</p>
            </button>

            <button
              data-form="change-order"
              class="form-selector-btn p-6 border-2 border-gray-600 rounded-lg hover:border-orange-500 hover:bg-orange-900/30 transition-all text-left"
            >
              <div class="text-3xl mb-2">üìù</div>
              <h3 class="font-semibold text-white mb-1">Change Order</h3>
              <p class="text-sm text-gray-400">Document project changes</p>
            </button>

            <button
              data-form="daily-report"
              class="form-selector-btn p-6 border-2 border-gray-600 rounded-lg hover:border-teal-500 hover:bg-teal-900/30 transition-all text-left"
            >
              <div class="text-3xl mb-2">üìÖ</div>
              <h3 class="font-semibold text-white mb-1">Daily Report</h3>
              <p class="text-sm text-gray-400">Daily construction log</p>
            </button>

            <button
              data-form="submittal"
              class="form-selector-btn p-6 border-2 border-gray-600 rounded-lg hover:border-purple-500 hover:bg-purple-900/30 transition-all text-left"
            >
              <div class="text-3xl mb-2">üì¶</div>
              <h3 class="font-semibold text-white mb-1">Submittal</h3>
              <p class="text-sm text-gray-400">Product submittals</p>
            </button>
          </div>

          <!-- Coming Soon: Payment Application -->
          <div class="mt-4 p-4 bg-yellow-900/20 border border-yellow-700 rounded-lg">
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-yellow-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div>
                <h4 class="font-semibold text-yellow-300 mb-1">Coming Soon: AIA Payment Application</h4>
                <p class="text-sm text-yellow-200">
                  AIA G702 & G703 Payment Application forms will be added in the next update. These forms will automatically populate from progress data and support the complete payment application workflow.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Form Container -->
      <div id="form-container">
        <div id="rfi-form" class="form-panel hidden">
          <RFIForm client:load projectId={id!} />
        </div>

        <div id="change-order-form" class="form-panel hidden">
          <ChangeOrderForm client:load projectId={id!} />
        </div>

        <div id="daily-report-form" class="form-panel hidden">
          <DailyReportForm client:load projectId={id!} />
        </div>

        <div id="submittal-form" class="form-panel hidden">
          <SubmittalForm client:load projectId={id!} />
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Form selection handler
  const formButtons = document.querySelectorAll('.form-selector-btn');
  const formPanels = document.querySelectorAll('.form-panel');

  formButtons.forEach(button => {
    button.addEventListener('click', () => {
      const formType = button.getAttribute('data-form');

      // Hide all forms
      formPanels.forEach(panel => {
        panel.classList.add('hidden');
      });

      // Remove active state from all buttons
      formButtons.forEach(btn => {
        btn.classList.remove('border-blue-500', 'border-orange-500', 'border-teal-500', 'border-purple-500', 'bg-blue-900/30', 'bg-orange-900/30', 'bg-teal-900/30', 'bg-purple-900/30');
      });

      // Show selected form
      const selectedForm = document.getElementById(`${formType}-form`);
      if (selectedForm) {
        selectedForm.classList.remove('hidden');

        // Add active state to button
        if (formType === 'rfi') {
          button.classList.add('border-blue-500', 'bg-blue-900/30');
        } else if (formType === 'change-order') {
          button.classList.add('border-orange-500', 'bg-orange-900/30');
        } else if (formType === 'daily-report') {
          button.classList.add('border-teal-500', 'bg-teal-900/30');
        } else if (formType === 'submittal') {
          button.classList.add('border-purple-500', 'bg-purple-900/30');
        }

        // Scroll to form
        selectedForm.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });
</script>

<style>
  .form-selector-btn {
    transition: all 0.2s ease;
  }

  .form-selector-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }
</style>
